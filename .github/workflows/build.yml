name: main
on: push
jobs:
  main:
    runs-on: windows-latest
    steps:
    - name: cache C:\Qt\5.15.2\mingw81_64
      uses: actions/cache@v4
      with:
        path: C:\Qt\5.15.2\mingw81_64
        key: Qt-5.15.2-mingw81_64
    - name: cache C:\Qt\Tools\mingw810_64
      uses: actions/cache@v4
      with:
        path: C:\Qt\Tools\mingw810_64
        key: mingw810_64
    - name: cache C:\mysql-8.2.0-winx64
      uses: actions/cache@v4
      with:
        path: C:\mysql-8.2.0-winx64
        key: mysql-8.2.0-winx64
    - name: cache qtbase-everywhere-src-5.15.2.zip
      uses: actions/cache@v4
      with:
        path: qtbase-everywhere-src-5.15.2.zip
        key: qtbase-everywhere-src-5.15.2.zip
    - name: toolchain
      shell: cmd
      run: |
        set PATH=C:\Miniconda3;C:\Miniconda3\Scripts;%USERPROFILE%\Miniconda3;%USERPROFILE%\Miniconda3\Scripts;C:\mysql-8.2.0-winx64\bin;C:\mysql-8.2.0-winx64\lib;C:\Program Files\7-Zip;C:\Qt\Tools\mingw810_64\bin;C:\Qt\5.15.2\mingw81_64\bin;%PATH%
        if exist C:\Qt\5.15.2\mingw81_64\bin\qmake.exe goto toolchain_end
        pip install aqtinstall
        aqt install-qt windows desktop 5.15.2 win64_mingw81 -O C:\Qt
        aqt install-tool windows desktop tools_mingw qt.tools.win64_mingw810 -O C:\Qt
        :toolchain_end
    - name: main
      shell: cmd
      run: |
        set PATH=C:\Miniconda3;C:\Miniconda3\Scripts;%USERPROFILE%\Miniconda3;%USERPROFILE%\Miniconda3\Scripts;C:\mysql-8.2.0-winx64\bin;C:\mysql-8.2.0-winx64\lib;C:\Program Files\7-Zip;C:\Qt\Tools\mingw810_64\bin;C:\Qt\5.15.2\mingw81_64\bin;%PATH%
        7z a -y Qt-5.15.2-mingw81_64.zip C:\Qt\5.15.2\mingw81_64
    - name: release
      uses: softprops/action-gh-release@v1
      if: startsWith(github.ref, 'refs/tags/')
      with:
        files: Qt-5.15.2-mingw81_64.zip
